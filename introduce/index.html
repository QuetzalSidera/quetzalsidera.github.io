<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é¡¹ç›®ä»‹ç» - A.L.I.C.Eå¼€æ”¾å¹³å°</title>
  <link rel="icon" type="image/png" href="../img/Logo.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
  <style>
    /* å†…å®¹åŒºåŸŸè°ƒæ•´ */
    .content-section {
      max-width: 100%;
    }

    /* æ·»åŠ å›åˆ°é¡¶éƒ¨æŒ‰é’® */
    .back-to-top {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 50px;
      height: 50px;
      background: var(--primary-color);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      box-shadow: 0 4px 12px rgba(255, 138, 61, 0.3);
      transition: all 0.3s;
      opacity: 0;
      visibility: hidden;
      z-index: 100;
    }

    .back-to-top.visible {
      opacity: 1;
      visibility: visible;
    }

    .back-to-top:hover {
      background: var(--primary-dark);
      transform: translateY(-3px);
    }
  </style>
</head>
<body>
<div id="app">
  <header class="site-header">
    <div class="navbar home top">
      <div class="wrapper">
        <div class="container">
          <div class="brand">
            <a class="logo-link" href="/">
              <img class="logo-image" src="../img/Logo.png" width="200" height="200" alt="Logo">
              <span>A.L.I.C.Eå¼€æ”¾å¹³å°</span>
            </a>
          </div>
          <div class="nav-content">
            <div class="nav-content-body">
              <nav class="nav-menu">
                <a class="nav-link" href="https://github.com/QuetzalSidera/QuetzalSidera-Me-FrontBackend">æºä»£ç </a>
                <a class="nav-link active" href="https://open.quetzalsidera.me/introduce">é¡¹ç›®ä»‹ç»</a>
                <a class="nav-link" href="https://open.quetzalsidera.me/friendLink">æ·»åŠ å‹é“¾</a>
                <a class="nav-link" href="https://open.quetzalsidera.me/doc">APIæ–‡æ¡£</a>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="content-wrapper">
    <!-- å†…å®¹åŒºåŸŸ -->
    <div class="container" style="padding: 80px 0;">
      <div class="content-with-sidebar">
        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
        <div class="content-section">
          <h1 id="ProjectOverview">ğŸŒ QuetzalSidera.Me é¡¹ç›®ä»‹ç»</h1>

          <h3>é¡¹ç›®ç¤ºæ„å›¾</h3>
          <p><img src="../img/æœåŠ¡æ¶æ„.png" alt="æœåŠ¡æ¶æ„å›¾" style="max-width: 100%;"></p>

          <h3>æŠ€æœ¯æ ˆ</h3>
          <ul>
            <li><strong>å‰ç«¯</strong>ï¼šASP.NET Core Blazor Â· HTML/CSS Â· RESTful API Â· gRPC Â· Caddyï¼ˆåå‘ä»£ç†ï¼‰</li>
            <li><strong>åç«¯</strong>ï¼šEF Core Â· SQLite Â· gRPC Â· SMTP</li>
            <li><strong>éƒ¨ç½²</strong>ï¼šDockerï¼ˆå…¨å®¹å™¨åŒ–éƒ¨ç½²ï¼‰</li>
          </ul>

          <h3>å®‰å…¨ä¸æ¶æ„</h3>
          <ul>
            <li>å…¨ç«™å¯ç”¨ <strong>HTTPS</strong>ï¼Œè¯ä¹¦ç”± <strong>Caddy + ZeroSSL</strong> è‡ªåŠ¨åŒ–ç®¡ç†ã€‚</li>
            <li>éƒ¨ç½²ä»…å¼€æ”¾ <strong>80 / 443</strong> ç«¯å£ï¼Œå…¶ä½™ç«¯å£ä»…åœ¨å®¹å™¨å†…éƒ¨å¯è§ã€‚</li>
            <li>æ‰€æœ‰ç»„ä»¶å‡ä½¿ç”¨ åŸç”Ÿ Blazor + HTML/CSS/C# æ„å»ºï¼Œ<strong>æ— ä»»ä½•ç¬¬ä¸‰æ–¹UIæ¡†æ¶ä¾èµ–</strong>ã€‚</li>
          </ul>

          <h2 id="ArchitectureDesign">âš™ï¸ æ¶æ„è®¾è®¡ç†å¿µ</h2>
          <p>ä¼ ç»Ÿ Blazor é¡¹ç›®å‰åç«¯æ˜¯ä¸åˆ†ç¦»çš„ï¼Œè€Œ <strong>QuetzalSidera.Me</strong> é‡‡ç”¨ <strong>å‰åç«¯åˆ†ç¦» + gRPC é€šä¿¡</strong> æ¨¡å¼ï¼Œå¤„äºä»¥ä¸‹è€ƒè™‘ï¼š</p>
          <ul>
            <li><strong>å‰åç«¯åˆ†ç¦»éƒ¨ç½²</strong>ï¼šå‰ç«¯å¯åœ¨å…¬ç½‘æœåŠ¡å™¨è¿è¡Œï¼Œä¸éœ€è¦å…¬ç½‘IPçš„ç¬¬ä¸‰æ–¹æœåŠ¡éƒ¨ç½²åœ¨ä½äºå†…ç½‘çš„åç«¯ï¼Œé€šè¿‡ <strong>Frp</strong> ç©¿é€é€šä¿¡ã€‚</li>
            <li><strong>å¸¦å®½ä¼˜åŒ–</strong>ï¼šä¾‹å¦‚é‚®ä»¶éªŒè¯ç å‘é€ç”±åç«¯å®Œæˆï¼Œé¿å…æ¯æ¬¡ä¼ è¾“å®Œæ•´ HTML å†…å®¹ã€‚</li>
            <li><strong>æ•°æ®éš”ç¦»</strong>ï¼šAI èŠå¤©ä¸Šä¸‹æ–‡ç”±åç«¯ç»´æŠ¤ï¼Œå‰ç«¯ä»…ä¼ è¾“æ–°æ¶ˆæ¯ï¼Œé™ä½è¯·æ±‚ä½“å¤§å°ã€‚</li>
            <li><strong>ç»Ÿä¸€åç«¯æœåŠ¡</strong>ï¼š
              <ul>
                <li>åœ¨ <code>chat.quetzalsidera.me</code> æ³¨å†Œçš„è´¦å·å¯ç”¨äº API è®¿é—®ã€‚</li>
                <li><code>api.quetzalsidera.me</code>å¯å®æ—¶æŸ¥è¯¢æˆ–ä¿®æ”¹<code>www.quetzalsidera.me</code>å†…å®¹ï¼Œå®ç°äº’é€šã€‚</li>
              </ul>
            </li>
            <li><strong>P.S.</strong>ï¼šæœ€å¼€å§‹æ˜¯è®¡åˆ’åš <strong>ç‰©ç†æ„ä¹‰</strong> ä¸Šçš„å‰åç«¯åˆ†ç¦»çš„ï¼Œå‰ç«¯ä½äºå…¬ç½‘æœåŠ¡å™¨ä¸Šï¼Œåç«¯ä½äºæ ¡å›­ç½‘å†…ï¼Œä½†æœ€åè€ƒè™‘åˆ°æ ¡å›­ç½‘ç¯å¢ƒå¹¶ä¸ç¨³å®šï¼ˆ<del>æœ‰ç¨³å®šè¿‡å—</del>ï¼‰ï¼Œå› æ­¤å°†åç«¯é¡¹ç›®åŒæ ·éƒ¨ç½²äºåŒä¸€ä¸ªäº‘æœåŠ¡å™¨ä¸Šï¼Œé€šè¿‡å®¹å™¨ç½‘ç»œé€šä¿¡ã€‚</li>
          </ul>

          <h2 id="GRPCvsRESTful">ğŸ”— gRPC v.s. RESTful</h2>
          <p>api.quetzalsidera.meå¼€æ”¾APIä½¿ç”¨RESTfulé£æ ¼:</p>
          <ul>
            <li>ç®€å•æ˜“ç”¨ï¼Œæ˜“äºç¼–å†™APIæ–‡æ¡£</li>
            <li>æ¥å£æ¸…æ™°ï¼Œç»´æŠ¤æˆæœ¬ä½ã€‚</li>
          </ul>

          <p>åç«¯->å‰ç«¯é€šä¿¡ä½¿ç”¨gRPC:</p>
          <ul>
            <li>æ”¯æŒ <strong>æœåŠ¡ç«¯æµå¼è¾“å‡º</strong>ï¼Œä¾¿äº AI å›å¤å®æ—¶ä¼ è¾“ã€‚</li>
            <li>åºåˆ—åŒ–é«˜æ•ˆï¼Œæ•°æ®åŒ…æ›´å°ã€‚</li>
            <li><code>.proto</code> æ–‡ä»¶å¯åŒæ—¶ç”Ÿæˆ <strong>å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯æ¥å£</strong>ï¼Œå¼€å‘æˆæœ¬ä½ã€‚</li>
          </ul>

          <h2 id="ContainerDeployment">ğŸ³ å®¹å™¨åŒ–éƒ¨ç½²</h2>
          <ul>
            <li><strong>å¤šé˜¶æ®µæ„å»º</strong>ï¼šæ„å»ºé•œåƒä¸è¿è¡Œé•œåƒåˆ†ç¦»ï¼Œå‡å°‘ä½“ç§¯ã€‚</li>
            <li><strong>å·æŒ‚è½½éš”ç¦»</strong>ï¼šç”¨æˆ·æ•°æ® / å¯†é’¥æ–‡ä»¶ / è¿è¡Œæ—¥å¿—åˆ†å·å­˜å‚¨ï¼Œå®‰å…¨å¯æ§ï¼ˆ<del>æ—¥å¿—å¤šäº†æ–¹ä¾¿ç›´æ¥åˆ æ—¥å¿—åº“</del>ï¼‰ã€‚</li>
          </ul>

          <pre>#compose.yaml
volumes:
  #æ•°æ®å·
  chat_data:
  www_data:
  api_data:
  #æ—¥å¿—å·
  log_data:
  www_log_data:
  chat_log_data:
  api_log_data:
  #å¯†é’¥å·
  www_key_data:
  chat_key_data:
  api_key_data:
 #Caddyå·
  caddy_data:
  caddy_logs:</pre>

          <ul>
            <li><strong>æœ€å°æš´éœ²é¢</strong>ï¼šä»…åå‘ä»£ç†å®¹å™¨æ˜ å°„ç‰©ç†ç«¯å£ï¼Œé˜²æ­¢å¤šä½™ç«¯å£æš´éœ²ã€‚</li>
          </ul>

          <pre>   #Caddyåå‘ä»£ç†
  caddy:
   #...
    ports:
      - "80:80"
      - "443:443"
    networks:
      - front-network
   #...</pre>

          <h2 id="Subprojects">ğŸ“ å­é¡¹ç›®è¯´æ˜</h2>

          <h3 id="MainSite">ğŸŒ www.quetzalsidera.me</h3>
          <p>ä¸ªäººåšå®¢å‰ç«¯ï¼Œä¸ºäº†æœç´¢å¼•æ“ä¼˜åŒ–è€Œé‡‡ç”¨äº†æœåŠ¡ç«¯æ¸²æŸ“ï¼Œæ•°æ®å‡æ¥è‡ªåç«¯æ•°æ®åº“ï¼Œå¹¶åœ¨å‰ç«¯å†…å­˜ä¸­è¿›è¡Œç¼“å­˜ï¼ˆå¤§éƒ¨åˆ†å†…å®¹ç¼“å­˜1å°æ—¶ï¼Œå¤©æ°”ç»„ä»¶ç¼“å­˜18åˆ†é’Ÿï¼‰ï¼Œå¯é€šè¿‡ API åŠ¨æ€ä¿®æ”¹å†…å®¹ã€‚</p>

          <h3 id="ChatSite">ğŸ’¬ chat.quetzalsidera.me</h3>
          <p>ç½‘é¡µç«¯ AI èŠå¤©é¡¹ç›®ï¼ŒAI è§’è‰²ä¸ºã€Šè”šè“æ¡£æ¡ˆã€‹åƒç¦§å¹´ç§‘æŠ€å­¦é™¢æ¸¸æˆå¼€å‘éƒ¨æœºå™¨äºº <strong>çˆ±ä¸½ä¸</strong> ã€‚æç¤ºè¯è¯·å‚è§æ–‡ä»¶ï¼š<code>Backend/ThirdParty/Assistant/AgentPrompt.cs</code></p>

          <h4 id="UserDataSync">1.ç”¨æˆ·æ•°æ®å¦‚ä½•è¿›è¡ŒåŒæ­¥</h4>
          <p>ç½‘é¡µç«¯æ¯æ¬¡åŠ è½½æ—¶ï¼Œä¼šä»æµè§ˆå™¨LocalStorageä¸­è¯»å–åŠ å¯†çš„ä»¤ç‰Œä¿¡æ¯ï¼Œå¹¶ä½¿ç”¨æœåŠ¡ç«¯çš„å¯†é’¥è¿›è¡Œè§£å¯†ï¼Œä»åç«¯åŒæ­¥å†å²å¯¹è¯è®°å½•ç½‘é¡µç«¯ã€‚ä¸ºå‡å°‘ä¸å¿…è¦çš„è½®è¯¢ï¼Œç½‘é¡µåªä¼šåœ¨"é¡µé¢ç¬¬ä¸€æ¬¡æ¸²æŸ“"æˆ–"ç™»å½•æˆåŠŸ"åä»æ•°æ®åº“è·å–å†å²è®°å½•ï¼Œè‹¥æ‚¨çš„åŒä¸€è´¦å·åœ¨åˆ«çš„åœ°æ–¹æœ‰æœªåŒæ­¥çš„å†å²è®°å½•ï¼Œè¯· <strong>åˆ·æ–°é¡µé¢</strong> ä»¥åŒæ­¥</p>

          <ul>
            <li>æµè§ˆå™¨ LocalStorage ä¸­ä¿å­˜åŠ å¯†ä»¤ç‰Œï¼ŒæœåŠ¡ç«¯è§£å¯†ååŒæ­¥å†å²å¯¹è¯ã€‚</li>
          </ul>

          <pre>var userGuid = await ProtectedLocalStorage.GetAsync&lt;string&gt;(AppState.UserGuidKey);
var authToken = await ProtectedLocalStorage.GetAsync&lt;string&gt;(AppState.AuthTokenKey);
var createTimestamp = await ProtectedLocalStorage.GetAsync&lt;long&gt;(AppState.CreateTimestampKey);
//...
await ChatService.GetUserInfoAsync();
await ChatService.SyncChatHistoryAsync();</pre>

          <ul>
            <li>æ— æ•ˆä»¤ç‰Œæ—¶è‡ªåŠ¨ç”³è¯·ä¸´æ—¶ç”¨æˆ·å¹¶å­˜å‚¨åˆ°LocalStorageï¼ˆä¸´æ—¶ç”¨æˆ·å†å²è®°å½•åœ¨12å°æ—¶å†…æ— æ›´æ–°è®¿é—®è®°å½•å³æ¸…é™¤ï¼‰ã€‚</li>
          </ul>

          <pre>await ChatService.GetTempUserAsync();
try
{
    await ProtectedLocalStorage.SetAsync(AppState.AuthTokenKey, ChatService.AuthToken.CookieString);
    await ProtectedLocalStorage.SetAsync(AppState.UserGuidKey, ChatService.AuthToken.UserGuid);
    await ProtectedLocalStorage.SetAsync(AppState.CreateTimestampKey, ChatService.AuthToken.CreateTimestamp);
}
catch
{
    //...
}</pre>

          <ul>
            <li>ç™»å½•/æ³¨å†Œåä¸´æ—¶ä¼šè¯è®°å½•è‡ªåŠ¨åˆå¹¶è‡³æ­£å¼è´¦æˆ·ã€‚</li>
          </ul>

          <pre>public async Task&lt;List&lt;ChatSessionModel&gt;&gt; SyncChatHistoryAsync()
{
    //...
    //éæ¸¸å®¢è´¦æˆ·ä¸”æœ¬åœ°è®°å½•æ¡æ•°ä¸ä¸º0
    if (AuthToken.IsRegistered && LocalHistory.History.Count != 0)
    {
        LocalHistory.UserGuid = AuthToken.UserGuid;
        //åˆå¹¶è®°å½•åˆ°åç«¯
        await chatSessionService.MergeHistoryAsync(LocalHistory);
    }
    //...
}</pre>

          <h4 id="UserDataSecurity">2.ç”¨æˆ·æ•°æ®å®‰å…¨å¦‚ä½•ä¿éšœ</h4>
          <ul>
            <li>å…¨ç«™ HTTPS + AntiForgery Cookieé˜²å¾¡CSRF/XSRFæ”»å‡»,ä»¥ä¸‹ä¸ºæºä»£ç ä¸­éƒ¨åˆ†å†…å®¹ï¼Œæ›´å¤šè¯·å‚è§<a href="https://learn.microsoft.com/zh-cn/aspnet/core/security/anti-request-forgery?view=aspnetcore-9.0">å¾®è½¯å®˜æ–¹æ–‡æ¡£</a>ã€‚</li>
          </ul>

          <pre> // æŒä¹…åŒ–å¯†é’¥åˆ°æŒ‡å®šè·¯å¾„
 builder.Services.AddDataProtection()
     .PersistKeysToFileSystem(new DirectoryInfo(path))
     .SetApplicationName("Chat.QuetzalSidera.Me");
//...
  app.UseAntiforgery();</pre>

          <ul>
            <li>å•æ¬¡ä¼šè¯æœŸé—´çš„ç”¨æˆ·èº«ä»½é‰´åˆ«ç”±Blazoræ¡†æ¶è‡ªåŠ¨å¤„ç†ï¼Œç”¨æˆ·é•¿æœŸä»¤ç‰ŒåŠ å¯†å­˜å‚¨äº LocalStorageï¼Œå¯†é’¥ä»…å­˜åœ¨äºæœåŠ¡ç«¯, å‚è§<a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.components.server.protectedbrowserstorage.protectedlocalstorage?view=aspnetcore-9.0">å¾®è½¯å®˜æ–¹æ–‡æ¡£</a>ã€‚</li>
            <li>æ‰€æœ‰è¾“å…¥è¾“å‡ºå‡è¿›è¡Œ HTML ç¼–ç é˜²æ­¢ XSS, æ­¤éƒ¨åˆ†ç”±Blazoræ¡†æ¶è‡ªåŠ¨å¤„ç†ï¼Œå‚è§<a href="https://learn.microsoft.com/zh-cn/aspnet/core/security/cross-site-scripting?view=aspnetcore-9.0">å¾®è½¯å®˜æ–¹æ–‡æ¡£</a>ã€‚</li>
            <li>å¯†ç é‡‡ç”¨ <strong>PBKDF2 + ç›</strong> å•å‘åŠ å¯†å­˜å‚¨ã€‚</li>
          </ul>

          <pre> public static string HashPassword(string plainPassword)
 {
    // ç”Ÿæˆéšæœºç›
    byte[] salt = GenerateRandomSalt();
    // ä½¿ç”¨ PBKDF2 è¿›è¡Œå“ˆå¸Œ
    byte[] hash = Pbkdf2(plainPassword, salt, Iterations, HashSize);
    // æ ¼å¼ï¼šç®—æ³•$è¿­ä»£æ¬¡æ•°$ç›$å“ˆå¸Œå€¼ï¼ˆå…¨éƒ¨ä½¿ç”¨Base64ï¼‰
    return $"{AlgorithmIdentifier}{Delimiter}{Iterations}{Delimiter}{Convert.ToBase64String(salt)}{Delimiter}{Convert.ToBase64String(hash)}";
 }</pre>

          <ul>
            <li>æ•°æ®åº“ä»…å¯¹å®¹å™¨ç½‘ç»œå¼€æ”¾è®¿é—®ã€‚</li>
          </ul>

          <h4 id="UserDataIntegrity">3.ç”¨æˆ·æ•°æ®å®Œæ•´æ€§å¦‚ä½•ä¿éšœ</h4>
          <p>æ•°æ®åº“ä¸ºæ¯ä½ç”¨æˆ·çš„å†å²è®°å½•åˆ†é…äº†åŒæ­¥é”å¯¹è±¡ï¼Œ é¿å…é’ˆå¯¹åŒä¸€ä¸ªè´¦æˆ·çš„å¹¶å‘æ“ä½œï¼ˆå¦‚å¤šç»ˆç«¯ç™»å½•ï¼‰å¯¼è‡´ç”¨æˆ·æ•°æ®ä¸ä¸€è‡´</p>

          <pre> public static bool UpdateSession(AuthTokenModel authTokenModel, string sessionGuid, List&lt;ChatMessageModel&gt; messages,
        string? title = null)
    {
        if (!HistoryLocks.ContainsKey(authTokenModel.UserGuid))
            HistoryLocks.TryAdd(authTokenModel.UserGuid, new Lock());
        lock (HistoryLocks[authTokenModel.UserGuid])
        {
           //æ•°æ®åº“æ“ä½œ...
        }
    }</pre>

          <p>å¹¶ä¸”æ•°æ®å…¥åº“å°†åœ¨AIæµå¼å›å¤ç»“æŸåè¿›è¡Œï¼Œé¿å…é˜»å¡AIå›å¤çº¿ç¨‹</p>

          <pre> public override async Task PostMessage(ChatMessagePostInfo request, IServerStreamWriter&lt;ChatMessage&gt; responseStream,
        ServerCallContext context){
     //...
     //æµå¼å›å¤
     await foreach (string responsePiece in deepsSeekClient.SendMessageAsync(messages))
                {
                    //...
                    await responseStream.WriteAsync(new ChatMessageModel()
                    {
                        MessageGuid = responseGuid,
                        Timestamp = responseTimestamp,
                        Talker = Talker.Agent,
                        Message = responsePiece,
                    });
                }

  //å›å¤ç»“æŸï¼Œå°†è®°å½•æ’å…¥æ•°æ®åº“
   DatabaseHelper.UpdateSession(authToken, session.SessionGuid, [message, response], title);
  }</pre>

          <h4 id="StreamingOutput">4.æµå¼è¾“å‡ºå®ç°</h4>
          <p>åœ¨æ¯è½®å¯¹è¯ä¸­ï¼ŒAIçš„å›å¤æ˜¯å®æ—¶ç”Ÿæˆçš„(æµå¼)ï¼Œè€Œä¸æ˜¯åœ¨å›å¤ç”Ÿæˆç»“æŸåæ‰è¢«æ•´ä½“å‘é€ç»™ç”¨æˆ·(éæµå¼)ã€‚ç”±äºç¬¬ä¸‰æ–¹APIè¯·æ±‚å‡ç”±åç«¯å‘èµ·ï¼Œæµå¼è¾“å‡ºæ„å‘³ç€ä»ç¬¬ä¸‰æ–¹æœåŠ¡å™¨->åç«¯->å‰ç«¯->ç”¨æˆ·é¡µé¢çš„å…¨é“¾æ¡éƒ½å¿…é¡»æ˜¯æµå¼çš„</p>

          <ul>
            <li><strong>ç¬¬ä¸‰æ–¹æœåŠ¡å™¨->åç«¯</strong>: DeepSeek API æä¾›æµå¼è¾“å‡ºã€‚</li>
          </ul>

          <pre>public async IAsyncEnumerable&lt;string&gt; SendMessageAsync(List&lt;ChatMessageModel&gt; messages)
{
    var client = new DeepSeek.Core.DeepSeekClient(ApiKey);
    //...
    var choices = client.ChatStreamAsync(request, CancellationToken.None);
    await foreach (var response in choices)
    {
        yield return response.Delta?.Content ?? string.Empty;
    }
}</pre>

          <ul>
            <li><strong>åç«¯->å‰ç«¯</strong>: åç«¯ä½¿ç”¨ gRPC æœåŠ¡ç«¯æµå¼ä¼ è¾“è‡³å‰ç«¯ã€‚</li>
          </ul>

          <pre>public override async Task PostMessage(ChatMessagePostInfo request, IServerStreamWriter&lt;ChatMessage&gt; responseStream,
        ServerCallContext context)
{
    //...
    await foreach (string responsePiece in deepsSeekClient.SendMessageAsync(messages))
    {
        //...
        await responseStream.WriteAsync(new ChatMessageModel()
        {
            MessageGuid = responseGuid,
            Timestamp = responseTimestamp,
            Talker = Talker.Agent,
            Message = responsePiece,
        });
    }
    //...
}</pre>

          <ul>
            <li><strong>å‰ç«¯->ç”¨æˆ·é¡µé¢</strong>: å‰ç«¯é€šè¿‡ Blazor å·®å¼‚åŒ–æ¸²æŸ“AIå›å¤æ°”æ³¡å®ç°å®æ—¶æ˜¾ç¤ºã€‚</li>
          </ul>

          <pre>//æµå¼è¾“å‡º
 private async Task SendMessage(){
    //...
    await foreach (var response in responses)
    {
        messageModel.Message += response.Message;
        //è°ƒç”¨StateHasChangedè§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“
        StateHasChanged();
    }
}</pre>

          <h3 id="APISite">ğŸ” api.quetzalsidera.me</h3>
          <p>å¼€æ”¾ RESTful APIï¼Œåœ¨<a href="https://chat.quetzalsidera.me">chat.quetzalsidera.me</a>æ³¨å†Œçš„ç”¨æˆ·å¯ç”³è¯· API Tokenã€‚</p>
          <p>æ›´å¤šå†…å®¹å‚è§<a href="https://open.quetzalsidera.me/doc">å¼€æ”¾APIæ–‡æ¡£</a></p>

          <h2 id="Highlights">ğŸ§© é¡¹ç›®äº®ç‚¹</h2>
          <ul>
            <li>ğŸ’¡ åŸç”Ÿ Blazor å‰ç«¯åŠ¨ç”»</li>
            <li>ğŸ§± çº¯å®¹å™¨åŒ–æ¶æ„</li>
            <li>ğŸ” HTTPS å…¨ç«™è‡ªåŠ¨è¯ä¹¦ + å…¨ç«™ AntiForgery Cookie + åŠ å¯†LocalStorageæŒä¹…åŒ–ä»¤ç‰Œ</li>
            <li>ğŸ§® æ•°æ®åº“å¹¶å‘å®‰å…¨è®¾è®¡</li>
            <li>ğŸŒ å‰ç«¯å¤šè¯­è¨€æ”¯æŒ</li>
            <li>ğŸ§  æµå¼è¾“å‡º</li>
            <li>ğŸ”’ å®Œæ•´ICPå¤‡æ¡ˆ + è”ç½‘å¤‡æ¡ˆ + å®‰å…¨è¯„ä¼°</li>
          </ul>
        </div>
      </div>
    </div>
  </main>

  <!-- å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
  <a href="#" class="back-to-top" title="å›åˆ°é¡¶éƒ¨">
    <i class="fas fa-arrow-up"></i>
  </a>

  <footer class="site-footer">
    <div class="container">
      <div class="footer-links">
        <section class="footer-section">
          <h3 class="footer-section-title">é¡¹ç›®</h3>
          <ul class="footer-links-list">
            <li><a class="footer-link" href="/introduce">é¡¹ç›®ä»‹ç»</a></li>
            <li><a class="footer-link" href="/doc">APIæ–‡æ¡£</a></li>
            <li><a class="footer-link"
                   href="https://github.com/QuetzalSidera/QuetzalSidera-Me-FrontBackend">æºä»£ç </a></li>
          </ul>
        </section>
        <section class="footer-section">
          <h3 class="footer-section-title">ç¤¾åŒº</h3>
          <ul class="footer-links-list">
            <li><a class="footer-link" href="https://github.com/QuetzalSidera">GitHub</a></li>
            <li><a class="footer-link" href="mailto:1969154690@qq.com">åé¦ˆ</a></li>
          </ul>
        </section>
        <section class="footer-section">
          <h3 class="footer-section-title">èµ„æº</h3>
          <ul class="footer-links-list">
            <li><a class="footer-link" href="https://www.quetzalsidera.me/">ä¸ªäººåšå®¢</a></li>
            <li><a class="footer-link" href="https://open.quetzalsidera.me/">å¼€æ”¾å¹³å°</a></li>
            <li><a class="footer-link" href="https://chat.quetzalsidera.me">çˆ±ä¸½ä¸</a></li>
          </ul>
        </section>
      </div>
      <div class="footer-bottom">
          <span class="copyright">
            <a class="footer-link" href="https://beian.miit.gov.cn/#/Integrated/index">
              Â© ç‰ˆæƒæ‰€æœ‰ 2025 QianShuang | Â© äººç‰©, ç¾æœ¯åŠæ•…äº‹æƒ…èŠ‚è‘—ä½œæƒå½’NEXON Gamesæ‰€æœ‰ | ç²¤ICPå¤‡2025477459å· | ç²¤å…¬ç½‘å®‰å¤‡44030002008220å· | æ­¤é¡µé¢ç”±Github Pagesæ‰˜ç®¡
            </a>
          </span>
      </div>
    </div>
  </footer>
</div>

<script>
  // ä¾§æ å¯¼èˆªäº¤äº’åŠŸèƒ½
  document.addEventListener('DOMContentLoaded', function() {
    const sidebarLinks = document.querySelectorAll('.sidebar-nav-link, .sidebar-nav-sub-link');
    const sections = document.querySelectorAll('h1[id], h2[id], h3[id], h4[id]');
    const backToTopBtn = document.querySelector('.back-to-top');

    // é«˜äº®å½“å‰æ´»åŠ¨é“¾æ¥
    function highlightActiveLink() {
      let currentSection = '';

      sections.forEach(section => {
        const sectionTop = section.offsetTop;
        if (scrollY >= sectionTop - 150) {
          currentSection = section.getAttribute('id');
        }
      });

      sidebarLinks.forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href') === '#' + currentSection) {
          link.classList.add('active');

          // ç¡®ä¿çˆ¶çº§èœå•é¡¹ä¹Ÿå±•å¼€
          let parentItem = link.closest('.sidebar-nav-sub-list');
          while (parentItem) {
            const parentLink = parentItem.previousElementSibling;
            if (parentLink && parentLink.classList.contains('sidebar-nav-link')) {
              parentLink.classList.add('active');
            }
            parentItem = parentItem.parentElement.closest('.sidebar-nav-sub-list');
          }
        }
      });
    }

    // æ˜¾ç¤º/éšè—å›åˆ°é¡¶éƒ¨æŒ‰é’®
    function toggleBackToTop() {
      if (window.scrollY > 300) {
        backToTopBtn.classList.add('visible');
      } else {
        backToTopBtn.classList.remove('visible');
      }
    }

    // ç›‘å¬æ»šåŠ¨äº‹ä»¶
    window.addEventListener('scroll', function() {
      highlightActiveLink();
      toggleBackToTop();
    });

    // ç‚¹å‡»é“¾æ¥å¹³æ»‘æ»šåŠ¨
    sidebarLinks.forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();

        const targetId = this.getAttribute('href').substring(1);
        const targetElement = document.getElementById(targetId);

        if (targetElement) {
          window.scrollTo({
            top: targetElement.offsetTop - 100,
            behavior: 'smooth'
          });
        }
      });
    });

    // å›åˆ°é¡¶éƒ¨æŒ‰é’®åŠŸèƒ½
    backToTopBtn.addEventListener('click', function(e) {
      e.preventDefault();
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    });

    // åˆå§‹é«˜äº®
    highlightActiveLink();
    toggleBackToTop();
  });
</script>
</body>
</html>
